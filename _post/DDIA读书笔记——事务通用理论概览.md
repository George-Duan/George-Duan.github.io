# DDIA读书笔记——事务通用理论概览

## ACID

事务所提供的安全保证即大家所熟知的ACID，分别是：

- 原子性(Atomicity)：在同一个事务中，客户端发起的多个写操作请求纳入到原子事务 ，在出现故障而导致没法完成最终提交时则会出现事务中止，并且数据库丢弃或撤销已完成的更改。

- 一致性(Consistency)：主要指对数据有特定的预期状态，任何数据更改必须满足这些状态约束(或者恒等条件)。如对于一个账单系统，账户的贷款余额应和借款余额保持平衡。DDIA中表明，这种状态一致性应该由应用层来维护，应用程序有责任正确的定义事务来保持一致性。

  原子性、隔离性和持久性是数据库自身的属性，而ACID中的一致性更多的是应用层的属性。应用程序可能借助数据库的原子性和隔离性以达到一致性，但一致性本身并不源于数据库

- 隔离性(Isolation)：并发执行的多个事务相互隔离，不能相互交叉。

- 持久性(Durability)：一旦事务提交成功，事务所写的任何数据不会丢失，即使硬件故障或数据库崩溃。

  DDIA声明没有哪一项技术能提供绝对的持久性保证。只有帮助降低风险的手段：如写入磁盘、复制到远程机器备份等。

不符合ACID标准的系统被称为BASE，即基本可用性(Basically Available)，软状态(Soft state)和最终一致性(Eventual consistency)。



## 并发事务的一致性问题

- 脏写(Dirty Write)：如果一个事务修改了另一个事务未提交修改过的数据，意味着发生了脏写
- 脏读(Dirty Read)：一个事务读到了另一个未提交事务修改过的数据，意味着发生了脏读
- 不可重复读(Non Repeatable Read)：一个事务修改了另一个未提交事务读取的数据，意味着发生了不可重复读
- 幻读(Phantom)：一个事务先根据某些搜索条件查询出一些记录，在该事务未提交时，另一个事务写入了一些符合搜索条件的记录(insert、update、delete)，意味着发生了幻读。

**严重程度：**

脏写 > 脏读 > 不可重复读 > 幻读 ；脏写太严重，在sql标准中，无论哪种隔离级别都不允许脏写情况的发生



## SQL标准中的4种隔离级别

- READ UNCOMMITTED：未提交读，可能发生脏读、不可重复读、幻读现象；
- READ COMMITTED：已提交读，可能发生不可重复读和幻读，但不可能发生脏读；
- REPEATABLE READ：可重复读，可能发生幻读，但是不可能发生脏读和不可重复读现象；
- SERIALIZABLE：可串行化，上述现象都不可能发生。